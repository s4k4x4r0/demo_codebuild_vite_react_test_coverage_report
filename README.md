# CodeBuild x Vite x React x テストカバレッジレポート デモアプリ

CodeBuild でフロントエンドアプリのテストカバレッジを確認するデモです!!!

## 手順

1. `.envrc` ファイルの作成

環境変数を設定するための `.envrc` を作成する。
なお、`.envrc` は Git 管理外になっています。

```bash
touch .envrc
```

2. AWS リージョンの設定

環境変数で任意のリージョンを設定してください。

```bash: .envrc
# ...

# AWS リージョン
export AWS_REGION="ap-northeast-1"
```

3. AWS 認証情報の設定

環境変数で AWS 認証情報を設定してください。
セキュリティの観点からアクセスキーは非推奨です。
なるべく、一時的な認証情報を使用するようにしてください。

```bash: .envrc
# ...

# AWS認証情報
export AWS_ACCESS_KEY_ID="<Your AWS Access Key ID>"
export AWS_SECRET_ACCESS_KEY="<Your AWS Secret Access Key>"
export AWS_SESSION_TOKEN="<Your AWS Session Token>"
```

4. 環境変数の有効化

```bash
direnv allow
```

5. CDK の bootstrap（初回のみ）

```bash
npx cdk bootstrap
```

6. スタックのデプロイ

```bash
npx cdk deploy
```

# メモ

- Vite のテンプレートからファイル移行中。
  <https://ja.vite.dev/guide/#trying-vite-online>
- tsconfig.node.json の`moduleResolution`は`node`じゃないと CDK 動かないかも？
- synth はできた！
- レポートとカバレッジを`web/.report/coverage`に出力するようにした。CodeBuild で読み込めるはず。

# 要件

## エピック：ユーザーが商品を購入する

### 1. ユーザーがログインする

- **As a**: 認証されていないユーザー
- **I want to**: ログインフォームにメールアドレスとパスワードを入力し、ログインボタンをクリックする
- **So that**: サイトにアクセスできるようになる

**アクセプタンス条件**

- 有効な認証情報でログインできること
- 無効な認証情報でログインした場合、エラーメッセージが表示されること
- ログイン成功後、トップページまたは前回見ていたページにリダイレクトされること
- 認証情報に誤りがある場合、サーバーサイドからのエラーレスポンスを適切にハンドリングし、UI にフィードバックを表示すること

### 2. ユーザーが商品を閲覧する

- **As a**: ログイン済みユーザー
- **I want to**: 商品一覧ページから商品を検索したり、カテゴリで絞り込んだり、人気順などで並び替えたりする
- **So that**: 探している商品を簡単に見つけられる

**アクセプタンス条件**

- 商品一覧がページネーションまたは無限スクロールで表示されること
- 検索機能が、商品名や説明文に含まれるキーワードで動作すること
- カテゴリごとのフィルター機能が動作すること
- 価格や新着順などでソートできること
- SWR を活用して、データのキャッシュと再検証を効率的に行うこと

### 3. ユーザーが商品の詳細を確認する

- **As a**: ログイン済みユーザー
- **I want to**: 商品一覧から特定の商品をクリックし、その詳細情報（画像、説明、価格、在庫状況、レビューなど）を確認する
- **So that**: 納得して購入を決められる

**アクセプタンス条件**

- 商品の複数の画像がカルーセルなどで表示されること
- 商品の在庫状況がリアルタイムで表示されること（在庫切れの場合は購入ボタンが無効になるなど）
- 商品の説明文、価格、レビューなどが正確に表示されること
- 商品詳細ページへの URL が、SEO を考慮したクリーンなものになること

### 4. ユーザーが商品をカートに追加する

- **As a**: ログイン済みユーザー
- **I want to**: 商品詳細ページで数量を選択し、「カートに追加」ボタンをクリックする
- **So that**: 後で購入するための商品を一時的に保存できる

**アクセプタンス条件**

- 商品をカートに追加した際、UI に何らかのフィードバック（例：トースト通知、カートアイコンの点滅）が表示されること
- カート内の商品数がリアルタイムで更新されること
- カートの合計金額がリアルタイムで計算されること
- SWR のミューテーション機能を使って、カートへの追加 API を呼び出し、UI を楽観的に更新すること

### 5. ユーザーがカートの内容を確認する

- **As a**: ログイン済みユーザー
- **I want to**: カートアイコンをクリックし、現在カートに入っている商品の一覧を確認する
- **So that**: 購入手続きに進む前に、内容を最終確認できる

**アクセプタンス条件**

- カート内の各商品について、画像、商品名、数量、単価、小計が表示されること
- カート内の商品の数量を変更できること
- カートから商品を削除できること
- カート全体の合計金額が正しく表示されること

### 6. ユーザーが注文手続きに進む

- **As a**: ログイン済みユーザー
- **I want to**: カートページで「レジに進む」ボタンをクリックする
- **So that**: 配送先や支払い方法の情報を入力できる

**アクセプタンス条件**

- 注文手続きの各ステップ（配送先入力、支払い方法選択、注文確認など）が明確に表示されること
- 配送先や支払い情報の入力フォームが React Hook Form を使ってバリデーションされること
- API から取得したユーザーの登録住所を初期値としてフォームに設定できること

### 7. ユーザーが注文を確定する

- **As a**: ログイン済みユーザー
- **I want to**: 注文内容（商品、配送先、支払い方法など）を最終確認し、「注文を確定」ボタンをクリックする
- **So that**: 商品の購入が完了する

**アクセプタンス条件**

- 注文確定時に、必要な情報がすべて揃っているか最終チェックが行われること
- 注文確定 API が成功した場合、注文完了ページにリダイレクトされること
- 注文確定 API が失敗した場合、エラーメッセージが表示され、ユーザーが再試行できること

### 8. ユーザーが注文完了を確認する

- **As a**: ログイン済みユーザー
- **I want to**: 注文完了ページで、注文が成功したことを確認する
- **So that**: 安心して購入を終えられる

**アクセプタンス条件**

- 注文番号、注文した商品、合計金額、配送先などの情報が表示されること
- 注文確認メールが自動的に送信されること
